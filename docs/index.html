<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Rishka: Rishka SDK</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="rishka-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">Rishka
   </div>
   <div id="projectbrief">RISC-V virtual runtime in C/C++ made for ESP32-WROVER</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Rishka SDK </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><ul><li class="level2"><a href="#autotoc_md0">How Does It Work?</a></li>
<li class="level2"><a href="#autotoc_md1">Installation</a><ul><li class="level3"><a href="#autotoc_md2">Rishka VM</a></li>
<li class="level3"><a href="#autotoc_md3">Compiling Examples</a><ul><li class="level4"><a href="#autotoc_md4">Using rishka-cc tool</a></li>
<li class="level4"><a href="#autotoc_md5">Manually Compiling</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md6">Dumping Raw Binaries</a></li>
<li class="level2"><a href="#autotoc_md7">Example</a></li>
<li class="level2"><a href="#autotoc_md8">Contributing</a></li>
<li class="level2"><a href="#autotoc_md9">License</a></li>
</ul>
</ul>
</div>
<div class="textblock"><div align="center"> <img src="rishka-logo.png" alt="" width="140" class="inline"/> </div><p ><img src="https://github.com/nthnn/rishka/actions/workflows/arduino_ci.yml/badge.svg" alt="Arduino CI" style="pointer-events: none;" class="inline"/> <img src="https://github.com/nthnn/rishka/actions/workflows/arduino_lint.yml/badge.svg" alt="Arduino Lint" style="pointer-events: none;" class="inline"/> <img src="https://github.com/nthnn/rishka/actions/workflows/rust_ci.yml/badge.svg" alt="Rust Build CI" style="pointer-events: none;" class="inline"/> <img src="https://github.com/nthnn/rishka/actions/workflows/sdk_ci.yml/badge.svg" alt="SDK Build CI" style="pointer-events: none;" class="inline"/> <img src="https://img.shields.io/github/repo-size/nthnn/rishka?logo=git&amp;label=Repository%20Size" alt="GitHub repo size" class="inline"/></p>
<p >Rishka is a RISC-V virtual runtime in C/C++ made for ESP32-WROVER with PSRAM specifically developed as kernel for <a href="https://github.com/nthnn/Jessy-OS">Jessy OS</a>.</p>
<div align="center"> <img src="rishka-ili9341.gif" alt="" class="inline"/> <br  />
<br  />
 <em>Rishka running shell example with an ILI9341 TFT LCD and FabGL.</em> </div><h2><a class="anchor" id="autotoc_md0"></a>
How Does It Work?</h2>
<p >The Rishka virtual runtime is a system designed to run special RISC-V binaries smoothly on ESP32-WROVER microcontroller units. Under the hood, the virtual machine serves as the main engine, while the kernel acts as its core component. The kernel handles system calls efficiently, providing a range of interfaces for accessing different system features and services.</p>
<p ><img src="assets/rishka-flow.png" alt="" width="65%" class="inline"/> <br  />
 <em>Simple comparison of Rishka-based OS and Linux-based OS (with an Ubuntu logo, lol).</em> </p>
<p >These include basic functions like managing files, as well as more complex tasks like controlling GPIO pins, attaching and detaching interrupts, and communication protocols such as <a class="el" href="d6/d81/classI2C.html" title="Class for handling I2C operations in Rishka applications.">I2C</a> and SPI. Additionally, the kernel manages system utilities specific to the Jessy OS, handling tasks like sub-process runtime and memory allocation.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Installation</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
Rishka VM</h3>
<p >Rishka VM is a lightweight and efficient virtual runtime environment designed for RISC-V binaries on ESP32-WROVER microcontrollers. Follow these steps to integrate Rishka into your Arduino projects:</p>
<ol type="1">
<li>Clone Rishka to your Arduino libraries, by typing the command below:</li>
</ol>
<div class="fragment"><div class="line">cd ~/Arduino/libraries</div>
<div class="line">git clone --depth 1 https://github.com/nthnn/rishka.git</div>
</div><!-- fragment --><ol type="1">
<li>Open your Arduino IDE, then navigate to <code><a class="el" href="db/d30/classFile.html" title="Class for handling file operations in Rishka applications.">File</a> &gt; Examples &gt; rishka</code> and select an example suitable for your project.</li>
<li>You're all set! Integrate Rishka into your project and start leveraging its capabilities.</li>
</ol>
<h3><a class="anchor" id="autotoc_md3"></a>
Compiling Examples</h3>
<h4><a class="anchor" id="autotoc_md4"></a>
Using rishka-cc tool</h4>
<p >To use <code>rishka-cc</code>, you can get it from the release page if available or compile it yourself by typing the following on your terminal. Just make sure you have installed Rust compiler and Cargo package manager on your system.</p>
<div class="fragment"><div class="line">cargo build --release</div>
</div><!-- fragment --><p >Alternatively, you can install the <code>rishka-cc</code> tool by typing the following below on your system terminal:</p>
<div class="fragment"><div class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/nthnn/rishka/main/support/install_rishka_cc.sh)&quot;</div>
</div><!-- fragment --><p >Before using <code>rishka-cc</code>, you must configure two (2) environment variables, as shown below.</p>
<div class="fragment"><div class="line">export RISHKA_LIBPATH=&lt;path to sdk library folder&gt;</div>
<div class="line">export RISHKA_SCRIPTS=&lt;path to scripts folder&gt;</div>
</div><!-- fragment --><p >The <code>RISHKA_LIBPATH</code> must be a folder where the <code><a class="el" href="d6/de4/librishka_8h.html" title="Main header file for the Rishka SDK.">librishka.h</a></code> header file is located, while the <code>RISHKA_SCRIPTS</code> should be a folder where both <code>launch.s</code> and the <code>link.ld</code> files are located. For example, assuming Rishka was moved to the libraries folder on Arduino IDE:</p>
<div class="fragment"><div class="line">export RISHKA_LIBPATH=/Arduino/libraries/rishka/sdk</div>
<div class="line">export RISHKA_SCRIPTS=/Arduino/libraries/rishka/scripts</div>
</div><!-- fragment --><p >If no problems occured and was configured as instructed, you can now seamlessly use the <code>rishka-cc</code>.</p>
<p ><img src="rishka-cc.png" alt="" width="90%" class="inline"/> </p>
<h4><a class="anchor" id="autotoc_md5"></a>
Manually Compiling</h4>
<p >To compile SDK examples provided with Rishka, follow these steps:</p>
<ol type="1">
<li>If you haven't already, install Qrepo by following the instructions available <a href="https://github.com/nthnn/Qrepo">here</a>.</li>
<li>Ensure you have the RISC-V64 GCC toolchain installed by running:</li>
</ol>
<div class="fragment"><div class="line">sudo apt install gcc-riscv64-unknown-elf</div>
</div><!-- fragment --><ol type="1">
<li>Open a terminal and navigate to the directory where you cloned the Rishka repository.</li>
<li>Use Qrepo to compile the examples by executing the following command:</li>
</ol>
<div class="fragment"><div class="line">qrepo run compile &lt;source-file&gt; &lt;output-name&gt;</div>
</div><!-- fragment --><p >Replace <code>&lt;source-file&gt;</code> with the path to the source file of the example you want to compile and <code>&lt;output-name&gt;</code> with the desired name for the output binary.</p>
<p >Examples:</p>
<div class="fragment"><div class="line">qrepo run compile examples/sdk/hello.cpp hello</div>
<div class="line"># This will output the binary file to dist/hello.bin</div>
</div><!-- fragment --><p >Now you have successfully compiled the example and can proceed with using the generated binary file.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Dumping Raw Binaries</h2>
<p >Dumping raw binary files can be helpful in debugging programs, traditionally. Hence, a simple script in Qrepo is available to dump instructions from a raw binary file of Rishka. You can utilize it by typing the following:</p>
<div class="fragment"><div class="line">qrepo run dump &lt;filename&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md7"></a>
Example</h2>
<p >This example demonstrates the usage of Rishka virtual machine on an ESP32-WROVER microcontroller. It initializes serial communication and SD card, waits for user input via serial port, loads the specified file into the Rishka VM, executes it, and then waits for the next input.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fabgl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;rishka.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SD.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SPI.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define TFT_CS     5            </span><span class="comment">// TFT SPI select pin</span></div>
<div class="line"><span class="preprocessor">#define TFT_SCK    18           </span><span class="comment">// TFT SPI clock pin</span></div>
<div class="line"><span class="preprocessor">#define TFT_MOSI   23           </span><span class="comment">// TFT SPI MOSI pin</span></div>
<div class="line"><span class="preprocessor">#define TFT_DC     15           </span><span class="comment">// TFT data/command pin</span></div>
<div class="line"><span class="preprocessor">#define TFT_RESET  4            </span><span class="comment">// TFT reset pin</span></div>
<div class="line"><span class="preprocessor">#define TFT_SPIBUS VSPI_HOST    </span><span class="comment">// TFT SPI bus</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define SD_CS      2            </span><span class="comment">// SD card chip select pin</span></div>
<div class="line"><span class="preprocessor">#define SD_SCK     14           </span><span class="comment">// SD card SPI clock pin</span></div>
<div class="line"><span class="preprocessor">#define SD_MOSI    13           </span><span class="comment">// SD card SPI MOSI pin</span></div>
<div class="line"><span class="preprocessor">#define SD_MISO    12           </span><span class="comment">// SD card SPI MISO pin</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// TFT display controller and Terminal instance</span></div>
<div class="line">fabgl::ILI9341Controller DisplayController;</div>
<div class="line">fabgl::Terminal Terminal;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// SPI instance for SD card</span></div>
<div class="line">SPIClass sdSpi(HSPI);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> setup() {</div>
<div class="line">    <span class="comment">// Initialize TFT display</span></div>
<div class="line">    DisplayController.begin(TFT_SCK, TFT_MOSI, TFT_DC, TFT_RESET, TFT_CS, TFT_SPIBUS);</div>
<div class="line">    DisplayController.setResolution(<span class="stringliteral">&quot;\&quot;TFT_320x240\&quot; 320 240&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize terminal</span></div>
<div class="line">    Terminal.begin(&amp;DisplayController);</div>
<div class="line">    Terminal.loadFont(&amp;fabgl::FONT_8x14);</div>
<div class="line">    Terminal.enableCursor(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize SD card</span></div>
<div class="line">    sdSpi.begin(SD_SCK, SD_MISO, SD_MOSI, SD_CS);</div>
<div class="line">    <span class="keywordflow">if</span>(!SD.begin(SD_CS, sdSpi, 80000000)) {</div>
<div class="line">        Terminal.println(<span class="stringliteral">&quot;Card \e[94mMount\e[97m Failed&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Rishka virtual machine instance</span></div>
<div class="line">    RishkaVM* vm = <span class="keyword">new</span> RishkaVM();</div>
<div class="line">    <span class="comment">// Initialize Rishka VM</span></div>
<div class="line">    vm-&gt;initialize(&amp;Terminal);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span>(!vm-&gt;loadFile(<span class="stringliteral">&quot;/sysinfo.bin&quot;</span>))</div>
<div class="line">        vm-&gt;panic(<span class="stringliteral">&quot;Failed to \e[94mload\e[97m specified file.&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run loaded program</span></div>
<div class="line">    vm-&gt;run(0, NULL);</div>
<div class="line">    <span class="comment">// Reset VM after program execution</span></div>
<div class="line">    vm-&gt;reset();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> loop() {</div>
<div class="line">    <span class="comment">// Delay to prevent continuous execution</span></div>
<div class="line">    vTaskDelay(10);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Contributing</h2>
<p >Contributions to Rishka are highly encouraged and appreciated! To contribute new features, bug fixes, or enhancements, please adhere to the following guidelines:</p>
<ol type="1">
<li>Fork the Rishka repository.</li>
<li>Create a new branch for your changes: <code>git checkout -b feature-name</code>.</li>
<li>Implement your changes and commit them: <code>git commit -m "Added new feature"</code>.</li>
<li>Push your changes to the branch: <code>git push origin feature-name</code>.</li>
<li>Submit a pull request for review and inclusion.</li>
</ol>
<h2><a class="anchor" id="autotoc_md9"></a>
License</h2>
<p >Rishka is distributed under the GNU General Public License v3.0. For further details, refer to the <a href="https://github.com/nthnn/rishka/blob/main/LICENSE">LICENSE</a> file.</p>
<div class="fragment"><div class="line">This program is free software: you can redistribute it and/or modify  </div>
<div class="line">it under the terms of the GNU General Public License as published by  </div>
<div class="line">the Free Software Foundation, version 3.</div>
<div class="line"> </div>
<div class="line">This program is distributed in the hope that it will be useful, but </div>
<div class="line">WITHOUT ANY WARRANTY; without even the implied warranty of </div>
<div class="line">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU </div>
<div class="line">General Public License for more details.</div>
<div class="line"> </div>
<div class="line">You should have received a copy of the GNU General Public License </div>
<div class="line">along with this program. If not, see &lt;http://www.gnu.org/licenses/&gt;.</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Copyright 2024 - <a href="https://github.com/nthnn" target="_blank">Nathanne Isip</a></li>
    </ul>
</div>